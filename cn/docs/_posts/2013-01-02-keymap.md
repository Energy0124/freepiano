---
vim: wrap expandtab ft=markdown
layout: docs
title: 键盘布局
lang: cn
---

FreePiano是高度可定制的，您可以定义键盘上任何一个按键按下和松开时的功能，您还可以自定义需要再键盘上显示的名称等。

## 什么是键盘布局？

在FreePiano中，我们把所有跟演奏相关的设置统称为键盘布局（map文件）。一个键盘布局是由一个或多个"分组"组成的，每个分组又包括了以下设置：

1. 全局演奏设置，比如曲调。
2. 输入相关的演奏设定，比如左右手的力度，升降八度等。
3. 输出相关的设定，比如钢琴的延音踏板。
4. 每个键盘按键按下或抬起时所要执行的动作。
5. 还可以指定一些按键上面要显示的文字。

对于输出和输出的区别，在现在还可以不去关心， 目前只要了解：在freepiano的默认布局方案中，"输入 0"代表左手，"输入 1"代表右手。

那么，什么内容是不包含在键盘布局中的呢？当然是一些跟演奏无关的设定了，比如说您现在用的时什么音源输出，键盘上是显示简谱还是显示音名都不会保存在键盘布局中。

## 载入和保存键盘布局

如果别人给您了一个键盘布局，那么该如何使用呢？

首先键盘布局在硬盘上是以扩展名位.map的文件存放在freepiano主程序所在的目录下的。这个目录下的所有扩展名为.map的文件都会出现在键盘布局菜单中，您可以很方便的切换。如果您有非常多的布局，并且不想放在程序文件夹中，您还可以通过菜单`键盘布局 -> 打开`来打开其他地方的键盘布局，或者可以直接把硬盘上的.map文件拖放到freepiano的主窗口内。

要想保存当前的键盘布局，可以选择菜单`键盘布局 -> 保存`或者`键盘布局 -> 另存为`。

## 修改键盘布局
您对于当前演奏参数的修改，比如`延音踏板`，`曲调`，`键盘力度`和`八度音高`都会被直接保存在当前分组内。

如果想要修改键盘上某一个按键的功能时，您就需要自定义这个按键。要自定义某个按键的功能，请在您要定义的按键上点`鼠标右键`，这时您就会看到按键定义的弹出框：

![按键定义对话框]({{ site.baseurl }}/cn/docs/img/key_setting.png)

窗口上面的三排按钮是来定义`音符`，无论您现在的按键是什么功能，点击任何一个按钮都会将选中的按键定义为音符。您可以分别定义音符的`音高`，`八度音高`和`通道`。之前我们已经讲过，一般情况下`输入 0`代表左手，`输入 1`代表右手，其他的通道在更复杂的演奏设置中才会用到，比如要定义功能键和播放音效等。

窗口的中间部分是这个按键所对应的`脚本`，FreePiano中的所有的参数和设置都可以使用脚本命令来修改。包括演奏音符。直接修改脚本可以完成一些更为复杂的设定，并且可以一次完成多个操作，比如“一键多音”。目前如果看不懂忽略它就可以了。

下面的按钮大多都是在写脚本的时候才需要用到的，现在我们需要注意的是`预设...`这个按钮，预设其实是一些预先写好的脚本，通过选择就可以直接使用了，比如“右手升八度”这样的功能键在预设中就有定义。再比如更复杂的“按下时抬起延音踏板，松开时踩下延音踏板”。预设也是学习脚本编写的一个很好的办法。

## 键盘分组

了解了键盘设定后，分组功能就很容易理解了， 它其实就是将键盘布局分为多套，您可以预先定义好没一套，然后再演奏中一键切换。

除了输出属性外的其他属性都会跟着分组改变，包括键盘上每个按键的功能。为了方便的在现有设置的基础上增加新的分组，FreePiano提供了分组设定的拷贝和粘贴操作。您可以在`键盘分组`菜单中找到对于分组的常用操作。

## 切换分组

您可以用键盘分组菜单来切换分组，也可以用鼠标点击钢琴键盘上最左边的`分组`后面的数字来切换分组，您还可以使用键盘快捷键来切换分组，当然之前需要把`切换分组`这样的指令设置到按键上，默认的键盘布局中F1和F2键可以增加或减少分组，预设菜单中有更多分组的切换方式。
